<% year = 0 %>
<% month = 0 %>

<%= month_calendar(attribute: :date, events: @expenditures) do |date, expenditures| %>
  <%= date.strftime("%d") %>
  <% if date.strftime("%d") == "15" %>
    <% year = date.strftime("%y").to_i %>
    <% month = date.strftime("%m").to_i %>
  <% end %>
  
  <% expenditures.each do |expenditure| %>
    <div>
      <%= link_to expenditure.price, edit_expenditure_path(expenditure), :style=>"color:red;" %>
    </div>
  <% end %>
<% end %>

<ul class="nav nav-tabs nav-justified mt-5">
  <li class="nav-item"><%= link_to '月別収支', root_url, class:"nav-link", :style=>"color:#777;" %></li>
  <li class="nav-item"><%= link_to 'カテゴリー別支出一覧', expenditures_path, class:"nav-link active", :style=>"color:#faa61a;" %></li>
  <li class="nav-item"><%= link_to 'カテゴリー別収入一覧', incomes_path, class:"nav-link", :style=>"color:#777;" %></li>
</ul>

<!--<table class="table table-striped">-->
<!--  <th><%= month %>月の支出</th><th></th><th></th>-->
<!--  <% total_price = 0 %>-->
<!--  <% @expenditures.each do |expenditure| %>-->
<!--    <% if expenditure.date.strftime("%Y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '日用品' %>-->
<!--      <% total_price += expenditure.price %> -->
<!--    <% end %>-->
<!--  <% end %>-->
<!--  <tr><td>日用品</td><td></td><td><%= total_price %></td></tr>-->
<!--</table>-->

<table class="table">
  <tr style="background-color:#fff9d0;"><th><%= month %>月のカテゴリー別支出</th><th></th><th></th></tr>
  <% total_price = 0 %>
  <% daily_necessaries = 0 %>
  <% food = 0 %>
  <% transportation = 0 %>
  <% clothes = 0 %>
  <% entertainment = 0 %>
  <% hobby = 0 %>
  <% etcetera = 0 %>
  <% @expenditures.each do |expenditure| %>
    <% if expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '日用品' %>
      <% daily_necessaries += expenditure.price %>
    <% elsif expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '食費' %>
      <% food += expenditure.price %>
    <% elsif expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '交通費' %>
      <% transportation += expenditure.price %>
    <% elsif expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '衣服' %>
      <% clothes += expenditure.price %>
    <% elsif expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '交際費' %>
      <% entertainment += expenditure.price %>
    <% elsif expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == '趣味' %>
      <% hobby += expenditure.price %>
    <% elsif expenditure.date.strftime("%y").to_i == year && expenditure.date.strftime("%m").to_i == month && expenditure.category == 'その他' %>
      <% etcetera += expenditure.price %>
    <% end %>
  <% end %>
  <tr><td>日用品</td><td></td><td><%= daily_necessaries %></td></tr>
  <tr><td>食費</td><td></td><td><%= food %></td></tr>
  <tr><td>交通費</td><td></td><td><%= transportation %></td></tr>
  <tr><td>衣服</td><td></td><td><%= clothes %></td></tr>
  <tr><td>交際費</td><td></td><td><%= entertainment %></td></tr>
  <tr><td>趣味</td><td></td><td><%= hobby %></td></tr>
  <tr><td>その他</td><td></td><td><%= etcetera %></td></tr>
</table>

<%= link_to '入力', new_expenditure_path, class:"btn btn-lg btn-warning col-12 col-sm-6 offset-sm-3 mt-3 mb-5" %>